{"componentChunkName":"component---src-templates-post-js","path":"/promise-all-with-async-await/","webpackCompilationHash":"","result":{"data":{"markdownRemark":{"html":"<p>Let's say I have an API call that returns all the users from a database and takes some amount of time to complete.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// First promise returns an array after a delay</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getUsers</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">:</span> <span class=\"token string\">'jon'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">:</span> <span class=\"token string\">'andrey'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">:</span> <span class=\"token string\">'tania'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">600</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now there's another call that relies on some information that exists in the entire array of users.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Second promise relies on the result of first promise</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getIdFromUser</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">users</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>users<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And a third call that modifies the second call.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Third promise relies on the result of the second promise</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">capitalizeIds</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">id</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">.</span><span class=\"token function\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I might try to run the first call, then use a <code class=\"language-text\">for...of</code> loop to run the subsequent calls that rely on it.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">runAsyncFunctions</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> users <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getUsers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> user <span class=\"token keyword\">of</span> users<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> userId <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getIdFromUser</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> capitalizedId <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">capitalizeIds</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>capitalizedId<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>users<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">runAsyncFunctions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>However, this will be my output:</p>\n<div class=\"gatsby-highlight\" data-language=\"terminal\"><pre class=\"language-terminal\"><code class=\"language-terminal\">jon\nJON\nandrey\nANDREY\ntania\nTANIA\n(3) [{…}, {…}, {…}]</code></pre></div>\n<p>I can use <code class=\"language-text\">Promise.all()</code> instead to run all of the first, then all the second, then all the third functions.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">runAsyncFunctions</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> users <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getUsers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>\n    users<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token parameter\">user</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> userId <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getIdFromUser</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span>\n\n      <span class=\"token keyword\">const</span> capitalizedId <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">capitalizeIds</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>capitalizedId<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span>\n\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>users<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"terminal\"><pre class=\"language-terminal\"><code class=\"language-terminal\">(3) [{…}, {…}, {…}]\njon\nandrey\ntania\nJON\nANDREY\nTANIA</code></pre></div>\n<p>Hope that helps someone.</p>\n<p>Here's the whole snippet you can run in the console.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// First promise returns an array</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getUsers</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">:</span> <span class=\"token string\">'jon'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">:</span> <span class=\"token string\">'andrey'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">:</span> <span class=\"token string\">'tania'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">600</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Second promise relies on the resulting array of first promise</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getIdFromUser</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">users</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>users<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Third promise relies on the result of the second promise</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">capitalizeIds</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">id</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">.</span><span class=\"token function\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">runAsyncFunctions</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> users <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getUsers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>\n    users<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token parameter\">user</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> userId <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getIdFromUser</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span>\n\n      <span class=\"token keyword\">const</span> capitalizedId <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">capitalizeIds</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>capitalizedId<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span>\n\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>users<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">runAsyncFunctions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>","timeToRead":2,"excerpt":"Let's say I have an API call that returns all the users from a database and takes some amount of time to complete. Now there's another call…","frontmatter":{"title":"Promise.all with Async/Await","thumbnail":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAEhElEQVQ4y1VUW0xUVxS9kPjRjzaVgghKbRtSjPDVVGwiElMVKlhppcYmvIbBgVAQCjqAjDA+eArYhAYZ3gaUhyllwAdgoMVo6jSpbbG0tNXagLxBHsLADPfO2T3rXobUk+zMyZlz19l7r7W24O3tJ2C9+rqTsNf/c0dBWY6ubm+F7Hz/4JWgQM2fnx7+0sLDGvxR7ONdvsHX3Ld4fsbvbMDFgwEaRycXd/kjH589ytevbXQWqkv/dsDeeZNHwId7w/pTE2upQN9H+rQu0qffkiNb2ymfaZPr6cA+1aCr29sh+IaIhI3Omx3WM6tZA/P0fE+nCsulS7k/0onYOkkVrhOzz+TbNJoTDHFOX2hTR50REzXVYkmOiTSqEvLy8s2zg77hskVYLxNgyfGVHMxkiwzLECsMpezZ8C+M6AW702Vknbe/5fslNj72iDXUVzJVZIZUfOG+pE2qp+3bd10ERsihJKVlKFPJzGT7wPcTm9F4lT+4wkTrOLOujNDszGOanvyLrCujtGoZ48DLrO/7dvLdecgG0Dj1V+Tm/k7oWv8FB/TsEi8hOiJT7OhopKpKA1tc+JeWl4Y58Az13Omg7i4j38+SeXGIls3DVGEoZzf4XVVEmlRywUSB+9VPONYrAtgEAUlxV6Sa6jKGzF7MP5XBVswAnKPrLVepuame7+f5+ZB8Pj/7j1xFQ0MlxasNYkZqE2318IoQIA0wp47MEkdHfuVljjHLyjNCqUqGs3SjvYU6jM3yHpmvmJX/Vy2jNDkxwNRRmWKB/i757Q5tFaAzfVon6bMKbCAAFy3LdsAhDrJAVVV1VHa5iu+tPJ7zmJZBlQrMLC+3SMrWdtGRw8mPBIgWGovlsujuamNzz5/IL8uXbRM0MPAzndN+TDnpwWQwVFFbayPdv9dNNnGc0Jreng6W8EUK05000rHQ04sAtAIQOrt9q5WBUdG6BsgmqL//J9KnBlCOdj+Vfl1Ord9co7t9nSStjtPC3FOQtQbYBkCzADvBAWezUfLSSyWjLGT58OEDMpnuyeWDGDCPO0rJFnaxoETKOtVJR0JSfhPgTTRUFaETx0b6FVLWANdBaUruGySDAJByZ5RmpgeZJkYn5nMM/z1H2wUYHd5MOF4t1tWWy6K1N9wOCrYR/39EUcAya22tp7joMlF36jq9uW1HDIS94cC+qEF4MzIsTertaaOa6kpZi/byVy2KRLBHQNi1NVXcLR0UE50uFZ3/gYICY4cwGmSrYGrA6LAR7HTzZrMsWjvb0B4eULIelTP7rtfIrRfECs/2iYlxlyHqcME+z/CLqQGjA1QdlSE1NdXQ1OTvDDqDNMAmHpme+oO1tNRRdKRWAljmyRby3rG7DBjqyEIHwcnZTR49WJgaMHox92Z8TIV4XM2bnVckJSSkyNIozC+WYqJPi3GqMrH4/ANCZnYwrE2btykzEcPRDoqpAaNnpDYS2IcDIFroDNLAGQhAz7Z6vBtuB3Nx9XB4aWxjOK7PMz41YHR4E3aCAyBa6Mzf72j7GpsyATG8THtmPj7+wn9eX9MXZc7DXQAAAABJRU5ErkJggg==","width":150,"height":150,"src":"/static/3ad602fc75443c85829299b46286a5e0/4148e/clock.png","srcSet":"/static/3ad602fc75443c85829299b46286a5e0/4148e/clock.png 1x,\n/static/3ad602fc75443c85829299b46286a5e0/de03e/clock.png 1.5x"}}},"slug":"promise-all-with-async-await","date":"2018-10-04T00:00:00.000Z","categories":["Code"],"tags":["async/await","es6","javascript","promise"],"template":"post"},"fields":{"slug":"/promise-all-with-async-await/","date":"2018-10-04T00:00:00.000Z"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/promise-all-with-async-await/"}}}